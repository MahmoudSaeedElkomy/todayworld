<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุจูุตูุฉ ุงููุนู: ุชุฃููุงุช ูู ุนุงูู ุงูููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Desert Sands & Papyrus with subtle modern accents -->
    <!-- Application Structure Plan: The SPA is designed as a guide through contemporary challenges. It starts with an engaging hero section. The core is a grid of interactive "Themes" cards, each representing a major topic from "ูุตุฉ ุนุงูู ุงูููู." Clicking a card reveals a modal/expanded section with detailed content, LLM-generated reflection questions, and practical insights. Global audio controls are positioned discreetly. This structure encourages thematic exploration and deep, AI-guided reflection on modern life. -->
    <!-- Visualization & Content Choices: 1. Hero: Bold title, descriptive text, clear call to action. 2. Themes Grid: Cards with titles, brief descriptions, and emojis. On click, they trigger a modal or expand an inline detail section. 3. Theme Detail View (Modal/Expanded): Contains the full text for the theme, an "ุชุฃูู ุนููู โจ" button (LLM-powered reflection question), and a "ูุฌูุฉ ูุธุฑ ุนูููุฉ ๐งญ" button (LLM-powered actionable wisdom). A new "ุฑุจุท ุจุงููุงุถู ๐" button (LLM-powered historical link) is added. Loading spinners provide visual feedback. 4. Audio (Tone.js): Gentle ambient music and subtle sound effects for interactions. Confirmed NO SVG graphics used. NO Mermaid JS used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #FDF8F0;
            color: #4E4234;
        }
        .bg-primary { background-color: #FDF8F0; }
        .bg-secondary { background-color: #F5EFE1; }
        .text-primary { color: #4E4234; }
        .text-accent { color: #8D6B4C; }
        .border-accent { border-color: #D4A056; }
        .bg-accent { background-color: #D4A056; }
        .bg-accent-hover:hover { background-color: #C08C3B; }
        .shadow-custom { box-shadow: 0 10px 25px -5px rgba(141, 107, 76, 0.1), 0 4px 6px -4px rgba(141, 107, 76, 0.1); }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #D4A056;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #FDF8F0;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: #4E4234;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-primary">
    <nav class="sticky top-0 z-50 bg-primary/80 backdrop-blur-md shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-accent">ุจูุตูุฉ ุงููุนู</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4 space-x-reverse">
                        <a href="#hero" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">ุงูุจุฏุงูุฉ</a>
                        <a href="#themes" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">ุชุญุฏูุงุช ุงูุนุตุฑ</a>
                        <a href="#action" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">ุฎุทูุชู ุงููุงุฏูุฉ</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <section id="hero" class="min-h-screen flex items-center justify-center text-center px-4 py-16">
            <div class="max-w-4xl">
                <h1 class="text-4xl md:text-6xl font-bold text-accent leading-tight">ุนุงููู ูุชุบูุฑ... ููุนูู ูุชุฌุฏุฏ!</h1>
                <p class="mt-6 text-lg md:text-xl text-primary max-w-2xl mx-auto">ูู ุฒููู ุชุชูุงุทูู ูููู ุงูุฃููุงุฌูุ ูุชุชุฏุงุฎูู ุงูุญูุงุฆููุ ุชุญุชุงุฌู ุจูุตูุฉู ุชุฑุดุฏููู. ูุฐูู ุชุฃููุงุชู ูู "ูุตุฉู ุนุงููู ุงููููู"ุ ููุชูุถูุกู ููู ุงูุฏุฑุจู ูุชูุนููููู ุนูู ูููู ูุงูุนูู ุจูุนูู ุนูููู.</p>
                <div class="mt-8">
                    <a href="#themes" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">ุงุจุฏุฃ ุงูุชุฃูู โจ</a>
                </div>
            </div>
        </section>

        <section id="themes" class="py-20 bg-secondary">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-accent">ุชุญุฏูุงุชู ุงูุนุตุฑู ูุจุตุงุฆุฑู ุงููุนู</h2>
                    <p class="mt-4 text-lg text-primary max-w-2xl mx-auto">ูู "ูุตุฉู ุนุงููู ุงููููู"ุ ููุณููุทู ุงูุถูุกู ุนูู ูุญุงูุฑู ุฃุณุงุณูุฉู ุชูุดููููู ูุงูุนูุง. ุงููุฑ ุนูู ูููู ูุญูุฑู ููุชุชุนููู ูุชูุญุตูู ุนูู ุจุตุงุฆุฑู ูููููุฉู.</p>
                </div>

                <div class="mt-16 grid gap-10 md:grid-cols-2 lg:grid-cols-3">
                    <!-- Theme Card 1: ุชูุงุฑู ุงูุณุทุญูุฉู ูุงูุจุญุซู ุนู ุงููุนูู -->
                    <div class="bg-primary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" onclick="openThemeModal(0)">
                        <span class="text-5xl mb-4 block">๐ฑ</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุชูุงุฑู ุงูุณุทุญูุฉู ูุงูุจุญุซู ุนู ุงููุนูู</h3>
                        <p class="text-primary">ูููู ููุคุซุฑู ุทููุงูู ุงููุนูููุงุชู ูุงูุชุฑูููู ุนูู ูุนููุงุ ูููุจุนุฏูุง ุนู ุฌููุฑู ุงููุฌูุฏูุ</p>
                    </div>

                    <!-- Theme Card 2: ุณุญุฑู ุงููุงุฏุฉู ูุบูุงุจู ุงูููุงุนุฉู -->
                    <div class="bg-primary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" onclick="openThemeModal(1)">
                        <span class="text-5xl mb-4 block">๐ฐ</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุณุญุฑู ุงููุงุฏุฉู ูุบูุงุจู ุงูููุงุนุฉู</h3>
                        <p class="text-primary">ุงูุชูุนููููู ุจุงูุฏููุง ูููุดููููุฉู ุงูุจุญุซู ุนู ุงูุณุนุงุฏุฉู ูู ุบูุฑู ููุงููุง.</p>
                    </div>

                    <!-- Theme Card 3: ุงูุงููุณุงูู ูุงููุญุฏุฉู ุงูุถุงุฆุนุฉู -->
                    <div class="bg-primary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" onclick="openThemeModal(2)">
                        <span class="text-5xl mb-4 block">๐</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุงูุงููุณุงูู ูุงููุญุฏุฉู ุงูุถุงุฆุนุฉู</h3>
                        <p class="text-primary">ููุงุฐุง ุชุชุฒุงูุฏู ุงูุงููุณุงูุงุชู ุงูููุฑูุฉู ูุงููุฌุชูุนูุฉูุ ููููู ููุนูุฏู ุงููุญูุฉูุ</p>
                    </div>

                    <!-- Theme Card 4: ุฅุฑูุงูู ุงูุฑูุญู ูุงูุจุญุซู ุนู ุงูุณูููุฉู -->
                    <div class="bg-primary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" onclick="openThemeModal(3)">
                        <span class="text-5xl mb-4 block">๐ง</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุฅุฑูุงูู ุงูุฑูุญู ูุงูุจุญุซู ุนู ุงูุณูููุฉู</h3>
                        <p class="text-primary">ุถุบูุทู ุงูุญูุงุฉู ุงูุญุฏูุซุฉู ูุชุฃุซูุฑูุง ุนูู ุงูุตุญุฉู ุงูููุณูุฉู ูุถุฑูุฑุฉู ุงูุงุณุชุฌูุงุนู.</p>
                    </div>

                    <!-- Theme Card 5: ููุฉู ุงูุนููู ููุณุคูููุฉู ุงูุฅูุณุงูู -->
                    <div class="bg-primary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" onclick="openThemeModal(4)">
                        <span class="text-5xl mb-4 block">๐ฌ</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ููุฉู ุงูุนููู ููุณุคูููุฉู ุงูุฅูุณุงูู</h3>
                        <p class="text-primary">ูููู ูููููู ููุนููู ุฃู ููููู ุณูุงุญุงู ุฐุง ุญุฏูููุ ููุณุคูููุชูุง ูู ุชูุฌููู ููุฎูุฑูุ</p>
                    </div>

                    <!-- Theme Card 6: ุงูุนุฒูุฉู ุงูุงูุชุฑุงุถูุฉู ููุงูุนู ุงูุงุชุตุงูู -->
                    <div class="bg-primary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" onclick="openThemeModal(5)">
                        <span class="text-5xl mb-4 block">๐</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุงูุนุฒูุฉู ุงูุงูุชุฑุงุถูุฉู ููุงูุนู ุงูุงุชุตุงูู</h3>
                        <p class="text-primary">ุชุฃุซูุฑู ุงูุนุงููู ุงูุฑููููู ุนูู ุนูุงูุงุชูุง ุงูุฅูุณุงููุฉู ูุถุฑูุฑุฉู ุงูุงุชุตุงูู ุงูุญูููููู.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="action" class="py-20 bg-primary">
            <div class="max-w-3xl mx-auto text-center px-4">
                <h2 class="text-3xl font-bold text-accent">ุฎุทูุชู ุงููุงุฏูุฉ: ูู ุจูุตูุฉู ููุนูู!</h2>
                <p class="mt-4 text-lg text-primary">ุจุนุฏู ุงูุชุฃููู ูู ุชุญุฏูุงุชู ุนุงููู ุงูููููุ ุชุฐูุฑู ุฃููู ุงูุชุบููุฑู ูุจุฏุฃู ูู ุฏุงุฎููู. ูููู ุฃูุชู ุงูุจูุตูุฉู ุงูุชู ุชูุฑุดุฏููู ูุญู ุงููุนูู ุงูุนูููู ูุงููุนูู ุงูุฅูุฌุงุจููู.</p>
                <p class="mt-6 text-xl font-bold text-accent">ุงููุนูู ููุณู ูุฌุฑุฏู ูุนุฑูุฉูุ ุจู ููู ูุนูู ููุญููููููู ูููุญููููู ุนุงููููู.</p>
                <div class="mt-8">
                     <p class="text-2xl font-bold text-primary">ูุง ูู ุงูุจุตูุฑุฉู ุงูุชู ุณุชูุทุจููุง ุงูููููุ</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-secondary">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-primary">
            <p>&copy; 2025 ุจูุตูุฉ ุงููุนู - ุชุฃููุงุช ูู ุนุงูู ุงูููู.</p>
        </div>
    </footer>

    <!-- Theme Detail Modal -->
    <div id="themeModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modal-theme-title" class="text-2xl font-bold text-accent mb-4"></h3>
            <span id="modal-theme-icon" class="text-5xl mb-4 block text-center"></span>
            <p id="modal-theme-full-text" class="text-primary leading-relaxed mb-6"></p>

            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6">
                <button id="reflect-theme-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                    ุชุฃูู ุนููู โจ
                </button>
                <button id="practical-insight-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                    ูุฌูุฉ ูุธุฑ ุนูููุฉ ๐งญ
                </button>
                <button id="link-to-past-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                    ุฑุจุท ุจุงููุงุถู ๐
                </button>
            </div>

            <div id="modal-ai-response-area" class="mt-6 p-4 bg-secondary rounded-lg shadow-inner text-primary hidden">
                <div class="loading-spinner hidden"></div>
                <p id="modal-ai-response-text" class="leading-relaxed"></p>
            </div>
            
            <!-- New div for historical link output -->
            <div id="historical-link-output" class="mt-6 p-4 bg-secondary rounded-lg shadow-inner text-primary hidden">
                <div class="loading-spinner hidden"></div>
                <p></p>
            </div>

            <div class="mt-8 p-4 bg-primary rounded-lg shadow-inner text-primary">
                <label for="personal-connection-input" class="block text-md font-medium text-accent mb-2">ููู ูุชุตู ูุฐุง ุงูููุถูุน ุจุชุฌุฑุจุชูุ (ุงุฎุชูุงุฑู)</label>
                <textarea id="personal-connection-input" class="w-full h-24 p-3 text-primary bg-secondary rounded-lg border-2 border-accent/30 focus:outline-none focus:border-accent resize-y"></textarea>
                <button id="get-personal-insight-btn" class="mt-4 bg-accent text-white font-bold py-2 px-6 rounded-full text-sm bg-accent-hover transition-all duration-300 transform hover:scale-105">
                    ุงุญุตู ุนูู ุจุตูุฑุฉ ุดุฎุตูุฉ ๐ก
                </button>
                <div id="personal-insight-output" class="mt-3 p-3 bg-secondary rounded-lg shadow-inner text-primary hidden">
                    <div class="loading-spinner hidden"></div>
                    <p></p>
                </div>
            </div>

        </div>
    </div>

    <div class="fixed bottom-4 left-4 bg-secondary p-3 rounded-full shadow-lg flex items-center space-x-2 z-50">
        <button id="toggle-music" class="text-accent text-xl focus:outline-none">
            ๐ถ
        </button>
        <button id="toggle-ambient-sound" class="text-accent text-xl focus:outline-none">
            ๐
        </button>
    </div>

    <script>
        const themesData = [
            {
                title: "ุชูุงุฑู ุงูุณุทุญูุฉู ูุงูุจุญุซู ุนู ุงููุนูู",
                icon: "๐ฑ",
                fullText: "ูู ุนุตุฑู ูุชุฏููู ูููู ุณููู ุงููุนูููุงุชู ูุงูุชุฑูููู ุงููุงููุชูุงููุ ูุฌุฏู ุฃููุณูุง ุบุงุฑูููู ูู ุจุญุฑู ูู ุงูุณุทุญูุฉูุ ุญูุซู ุชูุบุฑููุง ุงููุงุฌูุงุชู ุงูุจุฑุงูุฉู ูุชูููููุง ุงููุคุซุฑุงุชู ุงููุญุธูุฉู ุนู ุนููู ุงููุฌูุฏู. ูุฐุง ุงูุชูุงุฑู ุงูุฌุงุฑูู ูููุฏุฏู ูุฏุฑุชูุง ุนูู ุงูุชุฑููุฒู ูุงูุชูููุฑู ุงูุนููููุ ูููููุฏููุง ุจูุตูุฉู ุงููุนูู ุงูุญูููููู ูู ุฒุญุงูู ุงููุดุชุชุงุชู. ูู ููุตุจุญู ููุฌุฑุฏู ูุชููููู ุณุทุญููููุ ุฃู ูููุงููู ูุฐุง ุงูุชูุงุฑู ูููุจุญุซู ุนู ุงูุฌููุฑูุ"
            },
            {
                title: "ุณุญุฑู ุงููุงุฏุฉู ูุบูุงุจู ุงูููุงุนุฉู",
                icon: "๐ฐ",
                fullText: "ุจุงุชู ุงูุนุงููู ุงููููู ูุฏููุนุงู ุจููุซู ูุง ููุชูู ูุฑุงุกู ุงููุงุฏุฉู ูุงูุงุณุชููุงูู. ููุนุชูุฏู ุฃููู ุงูุณุนุงุฏุฉู ุชููููู ูู ุงูุชูุงูู ุงููุฒูุฏูุ ููููุงุณู ูููุชููุง ุจูุง ููููู ูุง ุจูุง ูุญูู ุนูููู. ูุฐุง ุงูุณุญุฑู ุงูุฎุงุฏุนู ูููุงุฏุฉู ูููููุฏู ุดุนูุฑุงู ุฏุงุฆูุงู ุจุงูููุตู ูุนุฏูู ุงูููุงุนุฉูุ ูููุนููู ุฑุคูุชููุง ูููุง ููู ุฃุนููู ูุฃุจูู ูู ุงูุญูุงุฉู. ูู ููุนูุฏู ุชุฑุชูุจู ุฃููููุงุชูุง ููุจุญุซู ุนู ุบูู ุงูุฑูุญู ุจุฏูุงู ูู ุบูู ุงูุฌููุจูุ"
            },
            {
                title: "ุงูุงููุณุงูู ูุงููุญุฏุฉู ุงูุถุงุฆุนุฉู",
                icon: "๐",
                fullText: "ุนูู ุงูุฑุบูู ูู ุชุทูุฑู ูุณุงุฆูู ุงูุงุชุตุงููุ ูุฑู ุชุฒุงูุฏุงู ูููููุงู ูู ุงูุงููุณุงูุงุชู ุงูููุฑูุฉูุ ุงูุณูุงุณูุฉูุ ูุงูุงุฌุชูุงุนูุฉู. ุจุงุชุชู ุงููุฆุงุชู ุชุชุตุงุฑุนูุ ูุชูุนูู ูู ุดุฃูู ุงูุฎูุงูุงุชู ุนูู ุญุณุงุจู ุงููุดุชุฑูุงุชู ุงูุฅูุณุงููุฉู. ูุฐุง ุงูุชุดุฑุฐูู ููุถุนูู ุงูุฃูุฉู ูููุนููู ุชูุฏูููููุง. ูููู ููุนูุฏู ุจูุงุกู ุฌุณูุฑู ุงูุชูุงุตูู ูุงูุชูุงูููุ ููุฌุฏู ุงููุญุฏุฉู ุงูุถุงุฆุนุฉู ูู ุนุงููู ุจุงุชู ูู ุฃูุณูู ุงูุญุงุฌุฉู ุฅูููุงุ"
            },
            {
                title: "ุฅุฑูุงูู ุงูุฑูุญู ูุงูุจุญุซู ุนู ุงูุณูููุฉู",
                icon: "๐ง",
                fullText: "ุณุฑุนุฉู ุงูุฅููุงุนู ูู ุนุงููู ุงููููู ูุถุบูุทุงุชู ุงูุญูุงุฉู ุงููุณุชูุฑุฉู ุชูููู ุจุธูุงููุง ุนูู ุฃุฑูุงุญูุงุ ูุชูุตูุจู ุงููุซูุฑููู ุจุงูุฅุฑูุงูู ุงูููุณููู ูุงูุฐููููู. ุงูุจุญุซู ุนู ุงูุณูููุฉู ุฃุตุจุญู ุถุฑูุฑุฉู ูููุญุฉู ูู ุธููู ูุฐุง ุงููุฑุฌู ูุงููุฑุฌู. ูู ููุชููู ูููู ุงูุงุณุชุฑุฎุงุกู ูุงูุงุชุตุงูู ุจูุฐูุงุชูุง ุงูุฏุงุฎููุฉูุ ุฃู ููุณูููู ุฃุฑูุงุญูุง ููุฏูุงูุฉู ุงูุฅุฑูุงููุ"
            },
            {
                title: "ููุฉู ุงูุนููู ููุณุคูููุฉู ุงูุฅูุณุงูู",
                icon: "๐ฌ",
                fullText: "ุงูุนููู ููุญููู ููุฒุงุชู ูุงุฆูุฉูุ ููููุฏูู ููุง ุฃุฏูุงุชู ุบูุฑู ูุณุจููุฉู ููุชุบููุฑู ุงูุนุงููู. ููููู ูุนู ูุฐูู ุงูููุฉู ุงูุนุธููุฉู ุชุฃุชู ูุณุคูููุฉู ูุจุฑู. ูุงูุนููู ููููู ุฃู ููููู ุฃุฏุงุฉู ุจูุงุกู ููุฏูู ูุนุงู. ูููู ูููุฌูู ูุฐูู ุงูููุฉู ุงููุงุฆูุฉู ูุญู ุงูุฎูุฑู ูุงูููุนู ุงูุจุดุฑูููุ ูููุญูููู ูู ุฃู ูุตุจุญู ุณุจุจุงู ูู ูุณุงุฏู ุฃู ุชุฏููุฑูุ"
            },
            {
                title: "ุงูุนุฒูุฉู ุงูุงูุชุฑุงุถูุฉู ููุงูุนู ุงูุงุชุตุงูู",
                icon: "๐",
                fullText: "ุฑุบูู ุฃููู ูุณุงุฆูู ุงูุชูุงุตูู ุงูุงุฌุชูุงุนููู ูุงูุนุงููู ุงูุฑููููู ูุฏ ูุชุญุง ุขูุงูุงู ุฌุฏูุฏุฉู ููุงุชุตุงููุ ุฅูุง ุฃูููุง ูุฏ ุฃุฏูููุง paradoxically ุฅูู ููุนู ูู ุงูุนุฒูุฉู ุงูุงูุชุฑุงุถูุฉู. ููุตุจุญู ููุญุงุทููู ุจุงูุงุชุตุงูุงุชู ุงูุณุทุญูุฉูุ ููููุฏู ุนููู ุงูุนูุงูุงุชู ุงูุฅูุณุงููุฉู ุงูุญููููุฉู ูุฌูุงู ููุฌูู. ูููู ูููุงุฒูู ุจููู ุนุงูููุง ุงูุฑููููู ููุงูุนู ุงูุงุชุตุงูู ุงูุจุดุฑูููุ ูููุนูุฏู ููุนูุงูุงุชูุง ูููุชููุง ูุฌููุฑููุงุ"
            }
        ];

        const themeModal = document.getElementById('themeModal');
        const closeButton = themeModal.querySelector('.close-button');
        const modalThemeTitle = document.getElementById('modal-theme-title');
        const modalThemeIcon = document.getElementById('modal-theme-icon');
        const modalThemeFullText = document.getElementById('modal-theme-full-text');
        const reflectThemeBtn = document.getElementById('reflect-theme-btn');
        const practicalInsightBtn = document.getElementById('practical-insight-btn');
        const linkToPastBtn = document.getElementById('link-to-past-btn'); // New button
        const modalAiResponseArea = document.getElementById('modal-ai-response-area');
        const modalAiResponseText = document.getElementById('modal-ai-response-text');
        const modalLoadingSpinner = modalAiResponseArea.querySelector('.loading-spinner');
        const historicalLinkOutput = document.getElementById('historical-link-output'); // New output area
        const historicalLinkText = historicalLinkOutput.querySelector('p');
        const historicalLinkSpinner = historicalLinkOutput.querySelector('.loading-spinner');
        const personalConnectionInput = document.getElementById('personal-connection-input');
        const getPersonalInsightBtn = document.getElementById('get-personal-insight-btn');
        const personalInsightOutput = document.getElementById('personal-insight-output');
        const personalInsightText = personalInsightOutput.querySelector('p');
        const personalInsightSpinner = personalInsightOutput.querySelector('.loading-spinner');

        let currentThemeIndex = -1; // To keep track of the currently open theme

        function openThemeModal(index) {
            currentThemeIndex = index;
            const theme = themesData[index];
            modalThemeTitle.textContent = theme.title;
            modalThemeIcon.textContent = theme.icon;
            modalThemeFullText.textContent = theme.fullText;
            
            // Hide all AI response areas and clear their content initially
            modalAiResponseArea.classList.add('hidden');
            modalAiResponseText.textContent = '';
            historicalLinkOutput.classList.add('hidden');
            historicalLinkText.textContent = '';
            personalInsightOutput.classList.add('hidden');
            personalInsightText.textContent = '';
            personalConnectionInput.value = ''; // Clear personal input

            themeModal.style.display = 'flex'; // Use flex to center
        }

        closeButton.addEventListener('click', () => {
            themeModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === themeModal) {
                themeModal.style.display = 'none';
            }
        });

        // Tone.js setup for background music
        let backgroundSynth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: "sawtooth" },
            envelope: { attack: 2, decay: 0.5, sustain: 0.8, release: 3 }
        }).toDestination();
        backgroundSynth.volume.value = -18;

        let musicLoop;
        let isMusicPlaying = false;

        function startMusic() {
            if (!musicLoop) {
                const chords = [
                    ["C4", "E4", "G4"], ["F4", "A4", "C5"], ["G4", "B4", "D5"], ["A4", "C5", "E5"]
                ];
                let chordIndex = 0;
                musicLoop = new Tone.Loop(time => {
                    backgroundSynth.triggerAttackRelease(chords[chordIndex % chords.length], "2n", time);
                    chordIndex++;
                }, "2n").start(0);
            }
            Tone.Transport.start();
            isMusicPlaying = true;
        }

        function stopMusic() {
            Tone.Transport.stop();
            Tone.Transport.cancel();
            backgroundSynth.releaseAll();
            musicLoop = null;
            isMusicPlaying = false;
        }

        document.getElementById('toggle-music').addEventListener('click', async () => {
            await Tone.start();
            if (isMusicPlaying) {
                stopMusic();
                document.getElementById('toggle-music').textContent = '๐';
            } else {
                startMusic();
                document.getElementById('toggle-music').textContent = '๐ถ';
            }
        });

        // Tone.js setup for ambient sound (e.g., wind, rain, very subtle drone)
        let ambientSynth = new Tone.NoiseSynth({
            envelope: {
                attack: 0.005,
                decay: 0.1,
                sustain: 0.1,
                release: 0.2
            }
        }).toDestination();
        ambientSynth.volume.value = -25; // Very low volume for ambient
        let ambientNoiseLoop;
        let isAmbientSoundPlaying = false;

        function startAmbientSound() {
            if (!ambientNoiseLoop) {
                ambientNoiseLoop = new Tone.Loop(time => {
                    // Randomize pitch/volume slightly for a more natural ambient feel
                    ambientSynth.triggerAttackRelease("8n", time, Math.random() * 0.5 + 0.5);
                }, "4n").start(0); // Trigger a sound every 4 beats
            }
            Tone.Transport.start();
            isAmbientSoundPlaying = true;
        }

        function stopAmbientSound() {
            Tone.Transport.stop();
            Tone.Transport.cancel();
            ambientSynth.releaseAll();
            ambientNoiseLoop = null;
            isAmbientSoundPlaying = false;
        }

        document.getElementById('toggle-ambient-sound').addEventListener('click', async () => {
            await Tone.start();
            if (isAmbientSoundPlaying) {
                stopAmbientSound();
                document.getElementById('toggle-ambient-sound').textContent = '๐'; // Muted icon
            } else {
                startAmbientSound();
                document.getElementById('toggle-ambient-sound').textContent = '๐'; // Playing icon
            }
        });

        // Gemini API integration functions
        async function callGeminiAPI(prompt, outputElement, spinnerElement) {
            outputElement.classList.remove('hidden');
            outputElement.querySelector('p').textContent = '';
            spinnerElement.classList.remove('hidden');

            const apiKey = "AIzaSyBt3W-fHQ-PPQBTPNlvKrC-XdVt_hz97QI"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    outputElement.querySelector('p').textContent = result.candidates[0].content.parts[0].text;
                } else {
                    outputElement.querySelector('p').textContent = 'ุชุนุฐุฑ ุชูููุฏ ุงูุฑุฏ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.';
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                outputElement.querySelector('p').textContent = 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงููููุฐุฌ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.';
            } finally {
                spinnerElement.classList.add('hidden');
            }
        }

        reflectThemeBtn.addEventListener('click', () => {
            if (currentThemeIndex === -1) return;
            const themeText = themesData[currentThemeIndex].fullText;
            const prompt = `ุจูุงุกู ุนูู ูุฐุง ุงููุต ุงูุฐู ูุตู ุชุญุฏููุง ูุนุงุตุฑูุงุ ุงุณุชุฎุฑุฌ ุณุคุงูุงู ุชุฃูููุงู ุนูููุงู ูุฏูุน ุงููุงุฑุฆ ููุชูููุฑ ุงูููุฏู ูู ูุงูุนู ูุนูุงูุชู ุจุงูููุถูุน. ุงุฌุนู ุงูุณุคุงู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู:\n\n"${themeText}"`;
            callGeminiAPI(prompt, modalAiResponseArea, modalLoadingSpinner);
        });

        practicalInsightBtn.addEventListener('click', () => {
            if (currentThemeIndex === -1) return;
            const themeText = themesData[currentThemeIndex].fullText;
            const prompt = `ุจูุงุกู ุนูู ูุฐุง ุงููุต ุงูุฐู ูุตู ุชุญุฏููุง ูุนุงุตุฑูุงุ ุงุณุชุฎูุต ูุฌูุฉ ูุธุฑ ุนูููุฉ ุฃู ูุตูุญุฉ ููุฌุฒุฉ ููุณุงุนุฏุฉ ุงููุฑุฏ ุนูู ุงูุชุนุงูู ูุน ูุฐุง ุงูุชุญุฏู ูู ุญูุงุชู ุงูููููุฉ. ุงุฌุนู ุงูุฅุฌุงุจุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู ููุจุงุดุฑุฉ:\n\n"${themeText}"`;
            callGeminiAPI(prompt, modalAiResponseArea, modalLoadingSpinner);
        });

        linkToPastBtn.addEventListener('click', () => { // New event listener for historical link button
            if (currentThemeIndex === -1) return;
            const themeTitle = themesData[currentThemeIndex].title;
            const themeText = themesData[currentThemeIndex].fullText;
            const prompt = `ุจูุงุกู ุนูู ุงูุชุญุฏู ุงููุนุงุตุฑ ุงูุชุงูู: "${themeTitle}"ุ ูุงููุต ุงููุงูู ุงูุฎุงุต ุจู: "${themeText}"ุ ุงุณุชุฎูุต ููุทูุง ุชุงุฑูุฎููุง ุฃู ุณููุฉ ูุชูุฑุฑุฉ ูู ูุณูุฑุฉ ุงูุฃูู ูุงูุดุนูุจ ุชุฑุชุจุท ุจูุฐุง ุงูุชุญุฏู. ูุง ุชุฐูุฑ ุฃุญุฏุงุซูุง ุชุงุฑูุฎูุฉ ูุญุฏุฏุฉ ุฃู ุดุฎุตูุงุชุ ุจู ุฑูุฒ ุนูู ุงูุณูู ูุงูุนุจุฑ ุงูุนุงูุฉ. ุงุฌุนู ุงูุฅุฌุงุจุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู ูููุฌุฒุฉ (ููุฑุฉ ูุงุญุฏุฉ).`;
            callGeminiAPI(prompt, historicalLinkOutput, historicalLinkSpinner);
        });

        getPersonalInsightBtn.addEventListener('click', () => {
            if (currentThemeIndex === -1) return;
            const personalText = personalConnectionInput.value;
            const themeText = themesData[currentThemeIndex].fullText;
            if (personalText.trim() === '') {
                personalInsightOutput.classList.remove('hidden');
                personalInsightText.textContent = 'ูู ูุถููุ ุงูุชุจ ุชุฌุฑุจุชู ุฃููุงู ููุญุตูู ุนูู ุจุตูุฑุฉ ุดุฎุตูุฉ.';
                return;
            }
            const prompt = `ุจูุงุกู ุนูู ูุฐุง ุงููุต ุงููุชุนูู ุจุชุญุฏู ูุนุงุตุฑ:\n"${themeText}"\n\nูุฑุจุทูุง ุจุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงูุดุฎุตูุฉ ุงูุชุงููุฉ:\n"${personalText}"\n\nูุฏู ุจุตูุฑุฉ ููุฌุฒุฉ (ุณุคุงู ุชุฃููู ุฃู ููุงุญุธุฉ) ุชุฑุจุท ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจุงูููุถูุน ุงูุนุงูุ ูุชุดุฌุนู ุนูู ุงูููู ุงูุฃุนูู. ุงุฌุนู ุงูุฅุฌุงุจุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู:\n\n`;
            callGeminiAPI(prompt, personalInsightOutput, personalInsightSpinner);
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
